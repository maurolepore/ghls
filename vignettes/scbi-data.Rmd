---
title: "scbi-data"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

This article shows how the ghr (GitHub-R) package can help you explore and gather data from multiple GitHub repositories.

## Motivation

As a collaborative researcher, your datasets may be scattered across multiple GitHub organizations and repositories. How can you easily find and access interesting datasets when you need them?

The ghr package helps you to navigate your GitHub files form R, using a syntax similar to that of `remotes::install_github()`. For example, this is a valid path to a GitHub directory: `"maurolepore/ghr/R@master"` (Notice the structure `"owner/repo/subdir@branch"`).

## Example

Here we'll use data from the Smithsonian Conservation Biology Institute (SCBI) ForestGEO plot. They present their data at <https://scbi-forestgeo.github.io/SCBI-ForestGEO-Data/>:

> This is the public data portal for the SCBI ForestGEO plot, which points to archive locations for our various data products (some in this repository, many elsewhere).

SCBI datasets are scattered across multiple organizations and repositories. We'll use the ghr package to find and access some of those datasets.

```{r}
library(ghr)
```

We'll also the purrr package to iterate over multiple elements of a vector.

```{r}
library(purrr)
```

## Climate

Climate data from SCBI is stored in the GitHub organization "forestgeo", particularly in the repository "Climate". 

`ghr_ls()` lists GitHub directories in a way similar to how `fs::dir_ls()` lists local directories. Here it reveals one ".md" file and two folders:

```{r}
ghr_ls("forestgeo/Climate/Met_Station_Data/SCBI")
```

The folders contains multiple files, including some .csv files:

```{r}
ghr_ls("forestgeo/Climate/Met_Station_Data/SCBI/Front Royal weather station")
```

We can use a regular expression (`regexp`) to focus, for example, on .csv files:

```{r}
ghr_ls(
  "forestgeo/Climate/Met_Station_Data/SCBI/ForestGEO_met_station-SCBI", 
  regexp = "[.]csv$"
)
```

### Species list

In addition to climate data, SCBI has a number of species-list datasets. These datasets are in the GitHub organization "SCBI-ForestGEO", in the "SCBI-ForestGEO-Data" repository, and in the "species-lists" folder.

```{r}
species_lists <- "SCBI-ForestGEO/SCBI-ForestGEO-Data/species_lists"
# Get the last part of the path
(subdirs <- basename(ghr_ls(species_lists)))
```

Let's explore the .csv files in each sub directory. To reduce duplication we first create a vector `paths` giving the path to all of the sub directories we want to explore. Then we apply `ghr_ls()` to each element in `paths` and focus on .csv files only via `regexp`.

```{r}
(paths <- file.path(species_lists, subdirs))

paths %>% 
  map(~ ghr_ls(.x, regexp = "[.]csv$"))
```

Instead of the file names we can show the first few rows of each file. We use `ghr_ls_download_url()` to get download URLs of each .csv file in each sub directory. To iterate over all sub directories we use `purrr::map()`.

```{r}
download_urls <- paths %>% 
  map(~ ghr_ls_download_url(.x, regexp = "[.]csv$")) %>%
  # Just to keep clarify which subdirectory the files come from
  set_names(subdirs)
download_urls
```

And finally we use `readr::read_csv()` to read each dataset into R. Again we use `purrr::map()` to iterate over each sub directory.

```{r, message=FALSE}
download_urls %>% 
  unlist() %>% 
  map(~ head(read.csv(.x, stringsAsFactors = FALSE)))
```
